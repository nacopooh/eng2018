<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>英語2018 進捗</title>

  <!-- iOS: ホーム画面からフルスクリーン -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="英語2018" />

  <!-- PWA関連（同じフォルダに置く想定。GitHub PagesのサブパスでもOKな相対パス） -->
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="apple-touch-icon" href="icon-180.png" />

  <style>
    :root{
      --bg:#0b1020; --panel:#121a2e; --muted:#93a4be; --line:#293246;
      --teal:#22d3ee; --green:#34d399; --ink:#04120a;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:#fff}
    header{padding:12px 12px 8px;background:var(--panel);position:sticky;top:0;border-bottom:1px solid var(--line)}
    h1{margin:0 0 4px;font-size:20px}
    #meta{display:flex;gap:12px;color:var(--muted);font-size:12px}
    .tabs{display:flex;gap:8px;margin-top:8px}
    .tab{padding:6px 12px;border-radius:12px;border:1px solid #333;cursor:pointer;font-size:14px}
    .tab.active{background:var(--teal);color:#000;border-color:transparent}

    main{padding:12px}
    .grid{display:flex;flex-wrap:wrap;gap:8px}
    .lesson{
      width:62px;height:62px;border-radius:12px;border:1px solid var(--line);
      background:#162039;display:flex;align-items:center;justify-content:center;
      font-weight:600;cursor:pointer;user-select:none;transition:transform .06s;
    }
    .lesson:active{transform:scale(.98)}
    .lesson.today{outline:2px solid var(--teal)}
    .lesson.done{background:var(--green) !important;color:var(--ink) !important;border-color:var(--green)!important}

    .panel{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:10px;margin-top:12px}
    .hint{color:var(--muted);font-size:12px;margin-top:6px}
  </style>
</head>
<body>
  <header>
    <h1>英語2018 進捗</h1>
    <div id="meta">
      <div id="today"></div>
      <div id="progress"></div>
    </div>
    <div class="tabs">
      <div class="tab active" data-tab="today">今日</div>
      <div class="tab" data-tab="all">一覧</div>
    </div>
  </header>

  <main>
    <section id="panel-today" class="panel">
      <div class="grid" id="grid-today"></div>
      <div class="hint">※ 当日中に本数を補充しません。先取り済みは緑のまま表示されます。</div>
    </section>
    <section id="panel-all" class="panel" hidden>
      <div class="grid" id="grid-all"></div>
    </section>
  </main>

 <script>
  /* …既存のコードはそのまま… */

  // ← render() の中では b.onclick を付けない（dataset.n だけ付ける）

  // ---- ここを追加（イベント委譲）----
  document.addEventListener('click', (ev)=>{
    const t = ev.target.closest('.lesson');
    if (!t) return;
    const n = +t.dataset.n;
    if (!Number.isInteger(n)) return;

    // 進捗のトグル
    if (completed.has(n)) completed.delete(n); else completed.add(n);
    save();

    // 同じ番号のタイルを全部反映（今日／一覧 両方）
    document.querySelectorAll(`.lesson[data-n="${n}"]`).forEach(el=>{
      el.classList.toggle('done');
    });

    // 進捗テキスト更新
    document.querySelector('#progress').textContent =
      `${completed.size}/${TOTAL}（${Math.round(completed.size*100/TOTAL)}%）`;
  });

  // ---- 既存の DOMContentLoaded 内は render() 呼び出しだけでOK ----
</script>

</body>
</html>
